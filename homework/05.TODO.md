# Домашнее задание №5
17.08-23.08
## Содержание
1. [Задание](#task)
    - [Checklist ](#checklist)
2. [Разработка ленты новостей социальной сети](#dev)

<a name="task"></a>
## Задание
Лента новостей социальной сети

Цель:
- В результате выполнения ДЗ вы создадите ленту новостей социальной сети.

В данном задании тренируются навыки:
- работа с кешами;
- работа с очередями;
- проектирование масштабируемых архитектур.

Требования:
- Разработать ленту новостей.
- Добавить функционал "добавление поста".
- Создается отдельная страница, куда пишутся все обновления друзей. Для этого нужно хранить подписчиков.
- Лента формируется на уровне кешей.
- Формирование ленты производить через постановку задачи в очередь на часть подписчиков, чтобы избежать эффекта леди Гаги.
- В ленте держать последние 1000 обновлений друзей.
- Лента должна кешироваться.

ДЗ сдается в виде ссылки на гитлаб и демонстрации работающего проекта, развернутого в интернете.

Критерии оценки:
Оценка происходит по принципу зачет/незачет.

Требования: Верно работает инвалидация кеша. Обновление лент работает через очередь. Есть возможность перестройки кешей из СУБД.

<a name="checklist"></a>
## Checklist
1. Разработать ленту новостей социальной сети
    - Добавить функционал "добавление поста"
    - Создать отдельную страницу, куда пишутся все обновления друзей. Для этого нужно хранить подписчиков
    - Лента формируется на уровне кешей
    - Формирование ленты производить через постановку задачи в очередь на часть подписчиков, чтобы избежать эффекта леди Гаги
    - В ленте держать последние 1000 обновлений друзей
    - Лента должна кешироваться
    - Верно работает инвалидация кеша
    - Обновление лент работает через очередь
    - Есть возможность перестройки кешей из СУБД
3. Развертывание проекта в heroku
4. Вывод

<a name="dev"></a>
## Разработка ленты новостей социальной сети

+   add_post
+       get subscribers (mysql)
+       create tasks in queue (batch) (rabbit)
+       process queue (update cache) (redis)
+   my_page (only my posts)
+   feed (последние 1000 обновлений друзей)
+       render (websocket):
+           Лента <- хэш (список записей)
+           update by ws msg
+           js on feed
+?  В ленте держать последние 1000 обновлений друзей (-fe,+be)


    Верно работает инвалидация кеша
        Есть возможность перестройки кешей из СУБД
+       транзакции при операциях с кэшем
+       created as id
+       rebuild subs queues + sub_reader: update FE view
+           set rebuild_flag in DB
+           add sub to rebuild queue
+           read queue rebuild
+               check/reset rebuild_flag in DB
+               delete (XTRIM mystream MAXLEN 0), reset FE msg, fill_from_db
+       js FE update

        methods
            post add
                append subs queues
            post edit
                rebuild subs queues
                sub_reader: update FE view
            post delete
                rebuild subs queues
                sub_reader: update FE view
            subs add
                rebuild subs queues
            subs del
                rebuild subs queues


!   Учесть возможность масштабирования сервиса. То есть сообщение должно доставляться только на тот экземпляр компонента, куда соединен клиент. Для этого можно использовать, например Routing Key из Rabbitmq
        Линейная масштабируемость сервиса вебсокетов (BE)
!   Описан процесс масштабирования RabbitMQ

!   Развертывание проекта в heroku
