# Домашнее задание №7
24.09-27.09
## Содержание
1. [Задание](#task)
    - [Checklist ](#checklist)
2. [Разработка ленты новостей социальной сети](#dev)

<a name="task"></a>
## Задание
Онлайн обновление ленты новостей

Цель:
- В результате выполнения ДЗ вы научитесь обновлять ленту новостей без перезагрузки страницы.

В данном задании тренируются навыки:
- работа с WebSocket.

Требования:
- Разработать компонент, куда будет подключаться клиент при открытии страницы ленты.
- Сервис должен слушать очередь обновлений ленты. При получении подписанным клиентом сообщения, отправлять его в браузер по WebSocket.
- Учесть возможность масштабирования сервиса. То есть сообщение должно доставляться только на тот экземпляр компонента, куда соединен клиент. Для этого можно использовать, например Routing Key из Rabbitmq.
- При добавлении поста у друга, лента должна обновляться автоматически (с небольшой задержкой).
- Корректная работа сервиса вебсокетов.
- Линейная масштабируемость сервиса вебсокетов.
- Описан процесс масштабирования RabbitMQ.

ДЗ принимается в виде исходного кода на github, документации по архитектуре и демонстрации работоспособности развернутого в интернете приложения.  
Критерии оценки:  
- Оценка происходит по принципу зачет/незачет.

<a name="checklist"></a>
## Checklist
1. Доработать ленту новостей социальной сети
    - Разработать компонент c websocket
    - Учесть возможность масштабирования сервиса

<a name="dev"></a>
## Разработка ленты новостей социальной сети
(дополнительное описание проекта есть в ДЗ 5)

### Доработаны эндпоинты:

#### /feed [GET] #лента новостей
 - содержит последние 1000 постов пользователей, на которые подписан user
 - обновляется с помощью websocket

#### /ws/feed # websocket компонент для обновления ленты
 - раз в 2 сек проверяются новые сообщения в кэше. (используется текущий указатель id в streams)
 - если есть новые сообщения они отображаются в ленте
 - при получении сообщения reset (допустим ктото удалил пост), лента в браузере очищается, текущий указатель стрима редиса устанавливается в 0, и лента заново наполняется из кэша

### Учесть возможность масштабирования сервиса:
 - Бэкенд разработан с учетом stateless, возможно масштабирование.
 - При использовании кэша redis в кластере, кэш хранится только на той ноде, куда соединен клиент (хеширование по username).
 - При развертывании в heroku используется один инстанс rabbitmq. Если добавить еще несколько, и использовать несколько очередей для обработки обновлений лент, то будет использоваться routing key.
    Плюс при использовании consistent-hash можно равномерно распределить обработку пользователей по разным очередям.
