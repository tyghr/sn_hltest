# Домашнее задание №8
28.09-04.10
## Содержание
1. [Задание](#task)
    - [Checklist ](#checklist)
2. [Вынести систему диалогов в отдельный сервис](#dev)

<a name="task"></a>
## Задание
Разделение монолита на сервисы

Цель:
- В результате выполнения ДЗ вы перенесете бизнес-домен монолитного приложения в отдельный сервис.

В данном задании тренируются навыки:
- декомпозиции предметной области;
- разделение монолитного приложения;
- работа с HTTP;
- работа с REST API и gRPC;

Требования:
- Вынести систему диалогов в отдельный сервис.
- Взаимодействия монолитного сервиса и сервиса чатов реализовать на Rest API или gRPC.
- Организовать сквозное логирование запросов.
- Предусмотреть то, что не все клиенты обновляют приложение быстро и кто-то может ходить через старое API.
- Описан протокол взаимодействия.
- Поддержаны старые клиенты.
- Новые клиенты верно ходят через новый API.

ДЗ сдается в виде исходного кода на github и отчета по устройству системы.

Критерии оценки:
- Оценка происходит по принципу зачет/незачет.

<a name="checklist"></a>
## Checklist
1. Вынести систему диалогов в отдельный сервис

<a name="dev"></a>
## Вынести систему диалогов в отдельный сервис

 - Сервис чатов разрабатывался изначально отдельно от основного сервиса (см ДЗ 4).  
   В данном задании я просто связал сервис чатов и основной сервис через REST.  
   В связи с этим, организация работы клиентов по старому API здесь не актуальна, т.к. старого API нет.

 - В предыдущей моей реализации сервиса чатов (ДЗ 4) было доступно всего два эндпоинта, /chat и /ws/chat.  
   Я решил доработать так:
   - /chat (страницу чата) доработать и перенести в основной сервис  
   - в основном сервисе для каждой сессии пользователя генерировать user_session_id и передавать в /ws/chat вместе с user_id  
   - в основном сервисе реализовать эндпоинт для валидации сессии  
   - в сервисе чатов в /ws/chat добавить проверку session_id (через API основного сервиса)

 - Все дальнейшие доработки по api в сервисе чатов также делать с межсервисной авторизацией по apikey.

 - В дальнейшей разработке учесть что основной сервис будет передавать session_id в заголовках запросов при общении с другими сервисами по API.  
   И при логировании в каждом сервисе указывать этот session_id. Таким образом мы обеспечим сквозное логирование запросов.  
